{% extends "base.html" %}
{% block content %}

<div class="page-header">
  <h2>üìß Email Notification Preferences</h2>
</div>

<div class="card" style="max-width: 950px; width: 100%;">
  <form method="POST" action="{{ url_for('notification_preferences') }}">
    
    <!-- RMA Age Threshold -->
    <div class="form-group">
      <label style="font-weight: 600; font-size: 16px; margin-bottom: 8px; display: block;">
        üìÖ Notify me about RMAs older than
      </label>
      <p style="color: var(--gray-600); font-size: 14px; margin: 0 0 12px 0;">
        Enter the number of days an RMA must be open before you want to be notified.
      </p>
      
      <div style="display: flex; align-items: center; gap: 10px;">
        <input type="number"
               name="rma_age"
               value="{{ prefs['days_threshold'] }}"
               min="1" max="365" required
               style="width: 100px; padding: 10px; font-size: 16px; font-weight: 600; text-align: center; border: 2px solid var(--primary); border-radius: 6px;">
        <span style="font-weight: 600; color: var(--gray-700);">days</span>
      </div>

      <div style="margin-top: 12px; display: flex; gap: 8px; flex-wrap: wrap;">
        <button type="button" onclick="document.querySelector('input[name=rma_age]').value=3" class="btn-secondary">3 days</button>
        <button type="button" onclick="document.querySelector('input[name=rma_age]').value=7" class="btn-secondary">7 days</button>
        <button type="button" onclick="document.querySelector('input[name=rma_age]').value=14" class="btn-secondary">14 days</button>
        <button type="button" onclick="document.querySelector('input[name=rma_age]').value=30" class="btn-secondary">30 days</button>
      </div>
    </div>
    
    <hr style="margin: 30px 0; border: none; border-top: 1px solid var(--gray-200);">

    <!-- Days of Week Selection -->
    <div class="form-group">
      <label style="font-weight: 600; font-size: 16px; margin-bottom: 12px; display: block;">
        üìÜ Days to Receive Notifications
      </label>
      <p style="color: var(--gray-600); font-size: 14px; margin: 0 0 15px 0;">
        Select which days of the week you want to receive emails.
      </p>

      <div class="day-row">
        <label class="day-checkbox-label">
          <input type="checkbox" name="notify_sunday" value="1" {% if prefs['notify_sunday'] %}checked{% endif %}>
          <span>Sunday</span>
        </label>

        <label class="day-checkbox-label">
          <input type="checkbox" name="notify_monday" value="1" {% if prefs['notify_monday'] %}checked{% endif %}>
          <span>Monday</span>
        </label>

        <label class="day-checkbox-label">
          <input type="checkbox" name="notify_tuesday" value="1" {% if prefs['notify_tuesday'] %}checked{% endif %}>
          <span>Tuesday</span>
        </label>

        <label class="day-checkbox-label">
          <input type="checkbox" name="notify_wednesday" value="1" {% if prefs['notify_wednesday'] %}checked{% endif %}>
          <span>Wednesday</span>
        </label>

        <label class="day-checkbox-label">
          <input type="checkbox" name="notify_thursday" value="1" {% if prefs['notify_thursday'] %}checked{% endif %}>
          <span>Thursday</span>
        </label>

        <label class="day-checkbox-label">
          <input type="checkbox" name="notify_friday" value="1" {% if prefs['notify_friday'] %}checked{% endif %}>
          <span>Friday</span>
        </label>

        <label class="day-checkbox-label">
          <input type="checkbox" name="notify_saturday" value="1" {% if prefs['notify_saturday'] %}checked{% endif %}>
          <span>Saturday</span>
        </label>
      </div>
    </div>

    <hr style="margin: 30px 0; border: none; border-top: 1px solid var(--gray-200);">

    <!-- Time Selection -->
    <div class="form-group">
      <label style="font-weight: 600; font-size: 16px; margin-bottom: 12px; display: block;">
        üïê Notification Time
      </label>

      {% set current_time = prefs['notification_time'] if prefs['notification_time'] else '09:00' %}

      <select name="notification_time" required class="time-select">
        <option value="08:00" {% if current_time == "08:00" %}selected{% endif %}>8:00 AM</option>
        <option value="09:00" {% if current_time == "09:00" %}selected{% endif %}>9:00 AM</option>
        <option value="10:00" {% if current_time == "10:00" %}selected{% endif %}>10:00 AM</option>
        <option value="11:00" {% if current_time == "11:00" %}selected{% endif %}>11:00 AM</option>
        <option value="12:00" {% if current_time == "12:00" %}selected{% endif %}>12:00 PM</option>
        <option value="13:00" {% if current_time == "13:00" %}selected{% endif %}>1:00 PM</option>
        <option value="14:00" {% if current_time == "14:00" %}selected{% endif %}>2:00 PM</option>
        <option value="15:00" {% if current_time == "15:00" %}selected{% endif %}>3:00 PM</option>
        <option value="16:00" {% if current_time == "16:00" %}selected{% endif %}>4:00 PM</option>
        <option value="17:00" {% if current_time == "17:00" %}selected{% endif %}>5:00 PM</option>
      </select>
    </div>

    <!-- Save Button -->
    <div class="ok-confirm-row">
      <button type="submit" class="ok-confirm-button">‚úÖ Save Notification Settings</button>
      <a href="{{ url_for('profile') }}" class="btn-secondary">Cancel</a>
    </div>

  </form>
</div>

<!-- Summary Box -->
{% set days = [] %}
{% if prefs['notify_sunday'] %}{% set _ = days.append('Sunday') %}{% endif %}
{% if prefs['notify_monday'] %}{% set _ = days.append('Monday') %}{% endif %}
{% if prefs['notify_tuesday'] %}{% set _ = days.append('Tuesday') %}{% endif %}
{% if prefs['notify_wednesday'] %}{% set _ = days.append('Wednesday') %}{% endif %}
{% if prefs['notify_thursday'] %}{% set _ = days.append('Thursday') %}{% endif %}
{% if prefs['notify_friday'] %}{% set _ = days.append('Friday') %}{% endif %}
{% if prefs['notify_saturday'] %}{% set _ = days.append('Saturday') %}{% endif %}

{% set days_label = days|join(', ') if days else 'no days selected' %}
{% set time_label = prefs['notification_time'] if prefs['notification_time'] else '09:00' %}

<div class="ok-summary-box">
  <div class="ok-summary-icon">‚ÑπÔ∏è</div>
  <div class="ok-summary-text">
    <div class="ok-summary-title">Current Notification Settings</div>
    <div class="ok-summary-body">
      RMAs older than <strong>{{ prefs['days_threshold'] }} days</strong>,  
      on <strong>{{ days_label }}</strong>  
      at <strong>{{ time_label }}</strong>.
    </div>
  </div>
</div>

<style>

.day-row {
  display: flex;
  gap: 12px;
  flex-wrap: nowrap;
  justify-content: space-between;
  overflow-x: visible;
}

.day-checkbox-label {
  position: relative;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
}

.day-checkbox-label input[type="checkbox"] {
  position: absolute;
  opacity: 0;
  pointer-events: none;
}

.day-checkbox-label span {
  padding: 10px 18px;
  background: var(--gray-50);
  border: 2px solid var(--gray-200);
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  color: var(--gray-700);
  transition: 0.2s;
}

.day-checkbox-label:hover span {
  background: var(--gray-100);
  border-color: var(--gray-300);
}

.day-checkbox-label input[type="checkbox"]:checked + span {
  background: #e0f2fe;
  border-color: #0284c7;
  color: #0284c7;
  font-weight: 600;
  box-shadow: 0 0 6px rgba(2, 132, 199, 0.25);
}

.time-select {
  padding: 10px 14px;
  font-size: 15px;
  font-weight: 500;
  border-radius: 6px;
  border: 2px solid var(--gray-300);
  background-color: white;
  width: 180px;
}

.time-select:focus {
  border-color: #0284c7;
  box-shadow: 0 0 6px rgba(2, 132, 199, 0.25);
}

.ok-confirm-row {
  margin-top: 30px;
  display: flex;
  gap: 10px;
  align-items: center;
}

.ok-confirm-button {
  flex: 1;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid #16a34a;
  background-color: #dcfce7;
  color: #166534;
  font-weight: 600;
  font-size: 15px;
  cursor: pointer;
}

.ok-confirm-button:hover {
  background-color: #bbf7d0;
}

.ok-summary-box {
  margin-top: 24px;
  max-width: 950px;
  padding: 14px 18px;
  border-radius: 8px;
  border: 1px solid #3b82f6;
  background-color: #eff6ff;
  display: flex;
  align-items: flex-start;
  gap: 10px;
}

.ok-summary-icon {
  font-size: 22px;
  line-height: 1;
}

.ok-summary-title {
  font-weight: 600;
  color: #1d4ed8;
}

.ok-summary-body {
  font-size: 14px;
  color: var(--gray-700);
}
</style>

{% endblock %}

